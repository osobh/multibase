############
# AWS Deployment Configuration
# This file extends the standard .env with AWS-specific settings
# Usage: Copy this to .env and update all values for your AWS environment
############

############
# Secrets - CRITICAL: CHANGE THESE BEFORE PRODUCTION
# Consider using AWS Secrets Manager or Parameter Store
############

POSTGRES_PASSWORD=your-super-secret-and-long-postgres-password
JWT_SECRET=your-super-secret-jwt-token-with-at-least-32-characters-long
ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE
SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJzZXJ2aWNlX3JvbGUiLAogICAgImlzcyI6ICJzdXBhYmFzZS1kZW1vIiwKICAgICJpYXQiOiAxNjQxNzY5MjAwLAogICAgImV4cCI6IDE3OTk1MzU2MDAKfQ.DaYlNEoUrrEn2Ig7tqibS-PHK5vgusbcbo7X36XVt4Q
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD=this_password_is_insecure_and_should_be_updated
SECRET_KEY_BASE=UpNVntn3cDxHJpq99YMc1T1AQgQpc8kfYTuRgBiYa15BLrx8etQoXz3gZv1/u2oq
VAULT_ENC_KEY=your-encryption-key-32-chars-min

# AWS Secrets Manager ARNs (optional - uncomment if using Secrets Manager)
# AWS_SECRETS_ARN=arn:aws:secretsmanager:us-east-1:123456789012:secret:supabase/prod-AbCdEf

############
# Database - AWS RDS PostgreSQL Configuration
############

# For AWS RDS, use the RDS endpoint instead of 'db'
# Example: mydb.c9akciq32.us-east-1.rds.amazonaws.com
POSTGRES_HOST=your-rds-endpoint.region.rds.amazonaws.com
POSTGRES_DB=postgres
POSTGRES_PORT=5432
# Default user is postgres (or the master username you chose when creating RDS)

# RDS-Specific Settings
# - Ensure your RDS instance has:
#   1. Publicly accessible: NO (access through EC2 in same VPC)
#   2. VPC Security Group: Allow port 5432 from EC2 security group
#   3. Parameter Group: rds.logical_replication = 1 (for Realtime)
#   4. Automated backups enabled
#   5. Multi-AZ deployment (recommended for production)

############
# Supavisor -- Database Pooler
############
POOLER_PROXY_PORT_TRANSACTION=6543
POOLER_DEFAULT_POOL_SIZE=20
POOLER_MAX_CLIENT_CONN=100
POOLER_TENANT_ID=your-tenant-id

############
# API Proxy - Kong Configuration for AWS ALB
############

KONG_HTTP_PORT=8000
KONG_HTTPS_PORT=8443

# Note: If using ALB, SSL/TLS termination happens at ALB level
# Kong should only listen on HTTP (8000)
# ALB Target Group should point to port 8000

############
# API - PostgREST Configuration
############

PGRST_DB_SCHEMAS=public,storage,graphql_public

############
# Auth - GoTrue Configuration for AWS
############

## General
# SITE_URL: Your frontend application URL
SITE_URL=https://your-app.com

# ADDITIONAL_REDIRECT_URLS: Comma-separated list of allowed redirect URLs
# Include all your frontend domains and localhost for development
ADDITIONAL_REDIRECT_URLS=https://staging.your-app.com,http://localhost:3000

JWT_EXPIRY=3600
DISABLE_SIGNUP=false

# API_EXTERNAL_URL: Your ALB DNS name or custom domain
# This is what clients will use to access your Supabase API
API_EXTERNAL_URL=https://api.your-domain.com

## Mailer Config
MAILER_URLPATHS_CONFIRMATION="/auth/v1/verify"
MAILER_URLPATHS_INVITE="/auth/v1/verify"
MAILER_URLPATHS_RECOVERY="/auth/v1/verify"
MAILER_URLPATHS_EMAIL_CHANGE="/auth/v1/verify"

## Email Auth - AWS SES Configuration (Recommended)
ENABLE_EMAIL_SIGNUP=true
ENABLE_EMAIL_AUTOCONFIRM=false

# For AWS SES SMTP:
SMTP_ADMIN_EMAIL=no-reply@your-domain.com
SMTP_HOST=email-smtp.us-east-1.amazonaws.com
SMTP_PORT=587
SMTP_USER=your-ses-smtp-username
SMTP_PASS=your-ses-smtp-password
SMTP_SENDER_NAME=Your App Name

ENABLE_ANONYMOUS_USERS=false

## Phone Auth - AWS SNS (Optional)
ENABLE_PHONE_SIGNUP=true
ENABLE_PHONE_AUTOCONFIRM=false

############
# Studio - Dashboard Configuration
############

STUDIO_DEFAULT_ORGANIZATION=Your Organization
STUDIO_DEFAULT_PROJECT=Production

STUDIO_PORT=3000

# SUPABASE_PUBLIC_URL: Your public-facing API URL (ALB URL or custom domain)
SUPABASE_PUBLIC_URL=https://api.your-domain.com

# Enable WebP support
IMGPROXY_ENABLE_WEBP_DETECTION=true

# OpenAI API key for SQL Editor Assistant (optional)
OPENAI_API_KEY=

############
# Functions - Edge Functions Configuration
############
FUNCTIONS_VERIFY_JWT=false

############
# Logs - Analytics Configuration
############

LOGFLARE_LOGGER_BACKEND_API_KEY=your-super-secret-and-long-logflare-key
LOGFLARE_API_KEY=your-super-secret-and-long-logflare-key

# Docker socket location
DOCKER_SOCKET_LOCATION=/var/run/docker.sock

# Google Cloud Project (if using BigQuery for analytics)
GOOGLE_PROJECT_ID=
GOOGLE_PROJECT_NUMBER=

############
# AWS-Specific Configuration
############

## AWS Region
AWS_REGION=us-east-1

## AWS S3 Storage Configuration
# IAM Role Method (Recommended):
#   - Attach IAM role to EC2/ECS with S3 permissions
#   - Leave AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY empty
#
# Access Key Method (Not recommended for production):
#   - Create IAM user with S3-only permissions
#   - Use access keys below
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# S3 Bucket Configuration
AWS_S3_BUCKET=your-supabase-storage-bucket

# Optional: Custom S3 endpoint for S3-compatible services (MinIO, DigitalOcean Spaces, etc.)
S3_ENDPOINT=

# S3 Force Path Style (false for AWS S3, true for S3-compatible services)
S3_FORCE_PATH_STYLE=false

# Storage File Size Limit (in bytes, default 50MB)
STORAGE_FILE_SIZE_LIMIT=52428800

# Storage Tenant ID
STORAGE_TENANT_ID=default

## ImgProxy S3 Configuration
IMGPROXY_USE_S3=true

############
# AWS CloudWatch Logs (Optional)
# To enable CloudWatch logging, uncomment the logging sections in docker-compose.aws.yml
############

# CloudWatch Log Group Prefix
# AWS_CLOUDWATCH_GROUP_PREFIX=/ecs/supabase

############
# AWS Networking Notes
############

# 1. VPC Configuration:
#    - Ensure all services are in the same VPC
#    - Use private subnets for database and internal services
#    - Use public subnets for ALB

# 2. Security Groups:
#    - ALB SG: Allow 443 from 0.0.0.0/0, 80 from 0.0.0.0/0
#    - EC2/ECS SG: Allow 8000 from ALB SG, all traffic from self
#    - RDS SG: Allow 5432 from EC2/ECS SG

# 3. Route53 (Optional):
#    - Create A record pointing to ALB
#    - Example: api.your-domain.com -> ALB DNS

# 4. Certificate Manager:
#    - Request SSL certificate for your domain
#    - Attach certificate to ALB HTTPS listener

############
# Required IAM Policies for S3 Storage
############

# Attach this policy to your EC2 instance profile or ECS task role:
# {
#   "Version": "2012-10-17",
#   "Statement": [
#     {
#       "Effect": "Allow",
#       "Action": [
#         "s3:GetObject",
#         "s3:PutObject",
#         "s3:DeleteObject",
#         "s3:ListBucket"
#       ],
#       "Resource": [
#         "arn:aws:s3:::your-supabase-storage-bucket/*",
#         "arn:aws:s3:::your-supabase-storage-bucket"
#       ]
#     }
#   ]
# }

############
# Deployment Checklist
############

# Before deploying to AWS:
# [ ] Generate secure secrets (use: openssl rand -base64 32)
# [ ] Create S3 bucket for storage
# [ ] Set up RDS PostgreSQL instance with logical replication
# [ ] Configure VPC and security groups
# [ ] Set up ALB with target group pointing to Kong (port 8000)
# [ ] Request SSL certificate in Certificate Manager
# [ ] Configure Route53 DNS (optional)
# [ ] Set up SES for email sending
# [ ] Create IAM role with S3 permissions
# [ ] Update all URLs in this file (SITE_URL, API_EXTERNAL_URL, SUPABASE_PUBLIC_URL)
# [ ] Test ALB health checks
# [ ] Enable CloudWatch logging (optional)
# [ ] Set up RDS automated backups
# [ ] Configure WAF for ALB (optional but recommended)
